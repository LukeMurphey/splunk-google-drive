<form>
  <label>Lookup CSV</label>
  <fieldset submitButton="true" autoRun="false">
    <input type="dropdown" token="realm">
      <label>Account</label>
      <fieldForLabel>realm</fieldForLabel>
      <fieldForValue>realm</fieldForValue>
      <search>
        <query>| rest /servicesNS/nobody/google_drive/storage/passwords | table realm clear_password</query>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </search>
    </input>
    <input type="dropdown" token="fileId">
      <label>File</label>
      <fieldForLabel>name</fieldForLabel>
      <fieldForValue>id</fieldForValue>
      <search>
        <query>| rest /servicesNS/nobody/google_drive/storage/passwords | search realm="$realm$"| getcsv</query>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </search>
    </input>
    <input type="radio" token="export_answer" searchWhenChanged="true">
      <label>Export Sheet?</label>
      <fieldForLabel>answer</fieldForLabel>
      <fieldForValue>answer</fieldForValue>
      <search>
        <query>| makeresults | eval answer="yes"  | append [|makeresults | eval answer="no"] | fields - _time</query>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </search>
      <change>
        <condition value="yes">
          <set token="show_category">true</set>
        </condition>
        <condition value="no">
          <unset token="show_category"></unset>
          <set token="outputlookup_filename">| noop</set>
        </condition>
      </change>
    </input>
    <input type="dropdown" depends="$show_category$" token="outputlookup_filename">
      <label>Destination Lookup Table</label>
      <fieldForLabel>title</fieldForLabel>
      <fieldForValue>output_command</fieldForValue>
      <search>
        <query>|rest /servicesNS/nobody/google_drive/data/lookup-table-files | dedup title | table eai:acl.app eai:appName filename title fields_list updated id | eval export_answer="$export_answer$" | eval output_command=case(export_answer=="yes", "| outputlookup ".title, export_answer=="no","") | dedup output_command</query>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </search>
      <choice value="| noop">None</choice>
      <default>| noop</default>
    </input>
  </fieldset>
  <row>
    <panel>
      <title>Information</title>
      <html>
      <table>
        <tr>
          <td>
           This Dashboard allows you to import data from a CSV file stored in Google Drive, into Splunk. You can start by selecting your Google Account, and then choosing one of the CSV files that you have available. <br/>
              <br/>
              <strong>Requirements:</strong> Each CSV you create should be formatted properly. If you open that CSV file in Google Sheets, you can confirm it looks correct. Here are some guidelines for verifying a CSV file is formatted correctly.  
              <ol>
  <li>
                  <strong>Row 1 should be reserved for your "header".</strong> These are also known as "column names" or "feature names". An example of a header is highlighted in green in the screenshot. You do not need to highlight your header in green.</li>
  <li>
                  <strong>All data should remain within the bounds of your header.</strong> So if you have 4 column names (like in the screenshot) you should only have data in columns A-D, not in column E. Your data should also start in Row 2, not in Row 1. Sample data is highlighted in yellow in the screenshot.  </li>
</ol>
<br/>
         If you've followed these guidelines and are still encountering errors, please reach out on Splunk Answers.      
          </td>
        </tr>
        <tr>
          <td>
            <center>
                <img src="/static/app/google_drive/sheet_info.jpg"/>
              </center>
          </td>
        </tr>
      </table>
 </html>
    </panel>
    <panel>
      <table>
        <search>
          <query>| rest /servicesNS/nobody/google_drive/storage/passwords `getcsv("$realm$", "$fileId$")` $outputlookup_filename$</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>
</form>